{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://outpost.zeroechelon.com/schemas/cost-event.schema.json",
  "title": "Outpost Cost Event",
  "description": "Schema for dispatch completion events sent to Ledger for cost tracking and billing",
  "type": "object",
  "required": [
    "event_type",
    "user_id",
    "dispatch_id",
    "agent",
    "model",
    "started_at",
    "ended_at",
    "duration_seconds",
    "vcpu",
    "memory_mb",
    "network_egress_bytes",
    "tokens_input",
    "tokens_output",
    "status",
    "workspace_mode"
  ],
  "properties": {
    "event_type": {
      "type": "string",
      "const": "dispatch_complete",
      "description": "Event type identifier for Ledger routing"
    },
    "user_id": {
      "type": "string",
      "description": "Unique identifier of the user who initiated the dispatch",
      "minLength": 1
    },
    "dispatch_id": {
      "type": "string",
      "description": "Unique identifier for this dispatch execution",
      "format": "uuid"
    },
    "agent": {
      "type": "string",
      "enum": ["claude", "codex", "gemini", "aider", "grok"],
      "description": "Agent type used for execution"
    },
    "model": {
      "type": "string",
      "description": "Specific model ID used for execution (e.g., claude-opus-4-5-20251101, gpt-5.2-codex)",
      "minLength": 1
    },
    "started_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when dispatch execution started"
    },
    "ended_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when dispatch execution completed"
    },
    "duration_seconds": {
      "type": "number",
      "minimum": 0,
      "description": "Total execution duration in seconds"
    },
    "vcpu": {
      "type": "number",
      "enum": [0.25, 0.5, 1.0, 2.0, 4.0],
      "description": "Virtual CPU allocation for the container (fractional cores)"
    },
    "memory_mb": {
      "type": "number",
      "minimum": 256,
      "description": "Memory allocation in megabytes"
    },
    "network_egress_bytes": {
      "type": "number",
      "minimum": 0,
      "description": "Total network egress in bytes during execution"
    },
    "tokens_input": {
      "type": "number",
      "minimum": 0,
      "description": "Number of input tokens consumed by the LLM"
    },
    "tokens_output": {
      "type": "number",
      "minimum": 0,
      "description": "Number of output tokens generated by the LLM"
    },
    "status": {
      "type": "string",
      "enum": ["success", "failure", "timeout"],
      "description": "Final execution status of the dispatch"
    },
    "workspace_mode": {
      "type": "string",
      "enum": ["ephemeral", "persistent"],
      "description": "Workspace storage mode used for execution"
    },
    "efs_size_bytes": {
      "type": ["number", "null"],
      "minimum": 0,
      "description": "EFS storage size in bytes for persistent workspaces. Null for ephemeral workspaces."
    }
  },
  "additionalProperties": false
}

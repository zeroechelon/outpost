{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://outpost.zeroechelon.com/schemas/v2/status.schema.json",
  "title": "Outpost Status Tool Schema",
  "description": "Schema definitions for the outpost_status MCP tool with streaming support",

  "definitions": {
    "LogEntry": {
      "type": "object",
      "description": "Individual log entry from agent execution",
      "properties": {
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of log entry"
        },
        "level": {
          "type": "string",
          "enum": ["debug", "info", "warn", "error"],
          "description": "Log severity level"
        },
        "message": {
          "type": "string",
          "description": "Log message content"
        },
        "source": {
          "type": "string",
          "enum": ["agent", "executor", "system"],
          "description": "Origin of the log entry"
        },
        "offset": {
          "type": "integer",
          "minimum": 0,
          "description": "Sequential offset for pagination continuity"
        }
      },
      "required": ["timestamp", "level", "message", "offset"],
      "additionalProperties": false
    },

    "ExecutionStatus": {
      "type": "string",
      "enum": ["pending", "running", "completed", "failed", "timeout", "cancelled"],
      "description": "Current state of the dispatch execution"
    }
  },

  "input": {
    "$id": "#/input",
    "title": "Status Request Parameters",
    "description": "Input parameters for outpost_status tool invocation",
    "type": "object",
    "properties": {
      "dispatch_id": {
        "type": "string",
        "format": "uuid",
        "description": "Unique identifier of the dispatch to query status for"
      },
      "include_logs": {
        "type": "boolean",
        "default": true,
        "description": "Whether to include execution logs in response"
      },
      "log_offset": {
        "type": "integer",
        "minimum": 0,
        "description": "Starting offset for log pagination. Use next_log_offset from previous response for streaming continuation"
      }
    },
    "required": ["dispatch_id"],
    "additionalProperties": false
  },

  "output": {
    "$id": "#/output",
    "title": "Status Response",
    "description": "Response payload from outpost_status tool",
    "type": "object",
    "properties": {
      "dispatch_id": {
        "type": "string",
        "format": "uuid",
        "description": "Echo of the queried dispatch identifier"
      },
      "status": {
        "$ref": "#/definitions/ExecutionStatus"
      },
      "progress": {
        "type": "number",
        "minimum": 0,
        "maximum": 100,
        "description": "Execution progress as percentage (0-100)"
      },
      "agent": {
        "type": "string",
        "enum": ["claude", "codex", "gemini", "aider", "grok"],
        "description": "Agent executing the dispatch"
      },
      "started_at": {
        "type": ["string", "null"],
        "format": "date-time",
        "description": "ISO 8601 timestamp when execution started, null if pending"
      },
      "ended_at": {
        "type": ["string", "null"],
        "format": "date-time",
        "description": "ISO 8601 timestamp when execution ended, null if still running"
      },
      "logs": {
        "type": "array",
        "items": {
          "$ref": "#/definitions/LogEntry"
        },
        "description": "Array of log entries, empty if include_logs is false"
      },
      "next_log_offset": {
        "type": ["integer", "null"],
        "minimum": 0,
        "description": "Continuation token for streaming. Pass as log_offset in next request. Null if no more logs available"
      },
      "has_more_logs": {
        "type": "boolean",
        "description": "Indicates if additional logs are available beyond current response"
      },
      "error": {
        "type": ["object", "null"],
        "properties": {
          "code": {
            "type": "string",
            "description": "Error code identifier"
          },
          "message": {
            "type": "string",
            "description": "Human-readable error description"
          }
        },
        "required": ["code", "message"],
        "additionalProperties": false,
        "description": "Error details if status is 'failed', null otherwise"
      }
    },
    "required": ["dispatch_id", "status", "progress", "agent", "started_at", "ended_at", "logs", "next_log_offset", "has_more_logs"],
    "additionalProperties": false
  }
}
